<?php class cleanto_userdetails {    public $id;    public $firstname;    public $lastname;    public $password;    public $phone;    public $address;    public $city;    public $state;    public $zip;    public $tablename="ct_users";    public $conn;    /*Function for Read Only one data matched with Id*/    public function readone(){        $query="select * from ".$this->tablename." where id='".$this->id."'";        $result=mysqli_query($this->conn,$query);        $value=mysqli_fetch_row($result);        return $value;    }    /*Function for Update service-Not Used in this*/    public function update_profile(){        $address = mysqli_real_escape_string($this->conn,$this->address);        $query="update ".$this->tablename." set first_name='".$this->firstname."'        ,phone='".$this->phone."'        ,last_name='".$this->lastname."'        ,address='".$address."'        ,city='".$this->city."'        ,state='".$this->state."'        ,zip='".$this->zip."'        ,user_pwd='".$this->password."'        where id='".$this->id."' ";        $result=mysqli_query($this->conn,$query);        return $result;    }    /* GET USER DETAIL FOR MY_APPOINTMENT PAGE */    public function get_user_details(){        $query="select *,s.title,p.net_amount as total_payment from ct_bookings as b,ct_payments as p,ct_services as s,ct_users as u where b.client_id = u.id and b.service_id = s.id and b.order_id = p.order_id and u.id = $this->id GROUP BY b.order_id order by b.order_id desc";        $result=mysqli_query($this->conn,$query);        return $result;    }        public function get_guest_details($booking){        if ($booking == 1) {         	$query="select *,s.title,p.partial_amount,p.net_amount as total_payment from ct_bookings as b,ct_payments as p,ct_services as s where b.service_id = s.id and DATE(b.booking_date_time) >= (DATE(NOW()) - INTERVAL 6 MONTH) and b.order_id = p.order_id GROUP BY b.order_id order by b.booking_date_time";        } else if ($booking == 0) {        	$query="select *,s.title,p.partial_amount,p.net_amount as total_payment from ct_bookings as b,ct_payments as p,ct_services as s where b.service_id = s.id and b.order_id = p.order_id and booking_date_time > DATE_SUB(CURDATE(), INTERVAL 5 MINUTE) and booking_date_time < DATE_SUB(CURDATE(), INTERVAL -2 DAY) GROUP BY b.order_id order by b.booking_date_time";        } else if ($booking == 2) {        	$query="select *,s.title,p.partial_amount,p.net_amount as total_payment from ct_bookings as b,ct_payments as p,ct_services as s where b.service_id = s.id and b.order_id = p.order_id and booking_date_time > DATE_SUB(CURDATE(), INTERVAL 5 MINUTE) GROUP BY b.order_id order by b.booking_date_time";        } else {       		$query="select *,s.title,p.partial_amount,p.net_amount as total_payment from ct_bookings as b,ct_payments as p,ct_services as s where b.service_id = s.id and b.order_id = p.order_id and p.order_id = '".$booking."' GROUP BY b.order_id order by b.booking_date_time";        }        $result=mysqli_query($this->conn,$query);        return $result;    }        public function get_acc_details($thedate){        if ($thedate <> '') {        	$query="select *,s.title,p.partial_amount,p.net_amount as total_payment from ct_bookings as b,ct_payments as p,ct_services as s where b.service_id = s.id and b.order_id = p.order_id and DATE(booking_date_time) = '".$thedate."' GROUP BY b.order_id order by b.booking_date_time";        } else {        	$query="select *,s.title,p.partial_amount,p.net_amount as total_payment from ct_bookings as b,ct_payments as p,ct_services as s where b.service_id = s.id and b.order_id = p.order_id and booking_date_time > DATE_SUB(CURDATE(), INTERVAL 5 MINUTE) and booking_date_time < DATE_SUB(CURDATE(), INTERVAL -1 DAY) GROUP BY b.order_id order by b.booking_date_time";        }        $result=mysqli_query($this->conn,$query);        return $result;    }        public function get_acc_report($thedate){        if ($thedate <> '') {        	$query="select *,s.title,p.partial_amount,p.net_amount as total_payment from ct_bookings as b,ct_payments as p,ct_services as s where b.service_id = s.id and b.order_id = p.order_id and MONTH(order_date) = MONTH('".$thedate."') and YEAR(order_date) = YEAR('".$thedate."') GROUP BY b.order_id order by b.order_date";        } else {        	$query="select *,s.title,p.partial_amount,p.net_amount as total_payment from ct_bookings as b,ct_payments as p,ct_services as s where b.service_id = s.id and b.order_id = p.order_id and MONTH(order_date) = MONTH(CURRENT_DATE()) and YEAR(order_date) = YEAR(CURRENT_DATE()) GROUP BY b.order_id order by b.order_date";        }        $result=mysqli_query($this->conn,$query);        return $result;    }        public function get_timing_details($booking){        $query="select * from ct_bookings_timer where order_id = '".$booking."'";        $result=mysqli_query($this->conn,$query);        return $result;    }        public function reset_timer($booking){        $query="delete from ct_bookings_timer where order_id = '".$booking."'";        $result=mysqli_query($this->conn,$query);        return $result;    }        public function get_hints_clues($booking){        $query="select * from ct_bookings_hints";        $result=mysqli_query($this->conn,$query);        return $result;    }        public function get_existinghints_clues($booking, $clue){        $query="select * from ct_bookings_progress where booking_id = '".$booking."' and progress_no = '" . $clue . "'";        $result=mysqli_query($this->conn,$query);        return $result;    }        public function get_timer_details($order_id){        $query="select * from ct_bookings_timer where order_id = '".$order_id."'";        $result=mysqli_query($this->conn,$query);        return $result;    }        public function process_completion_admin($order_id){        $query="update ct_bookings_timer set order_date_completed = now() where order_id = '".$order_id."'";        $result=mysqli_query($this->conn,$query);        return $result;    }            public function get_guest_contact_details($orderid){        $query="select * from ct_order_client_info where order_id = '".$orderid."'";        $result=mysqli_query($this->conn,$query);        return $result;    }        /* GET NOTES FO THE USER FOR RESCHEDULE */    public function get_user_notes($orderid){        $query="select client_personal_info from ct_order_client_info where order_id = $orderid";        $result=mysqli_query($this->conn,$query);        $value = mysqli_fetch_row($result);        return $value;    }    /* update the booking datails of user */    public function reschedule_booking($finaldate,$orderid,$bookingstatus,$readstatus,$lastmodify){        $query ="UPDATE ct_bookings SET booking_date_time = '".$finaldate."',booking_status = '".$bookingstatus."',read_status = '".$readstatus."',lastmodify = '".$lastmodify."' where order_id = $orderid";        $result=mysqli_query($this->conn,$query);        return $result;    }        public function reschedule_booking_admin($finaldate,$orderid,$bookingstatus,$readstatus,$lastmodify,$amountdue, $players, $room, $username, $email, $phone){        $query ="UPDATE ct_payments SET amount = '".$amountdue."', net_amount = '".$amountdue."' where order_id = $orderid";        $result=mysqli_query($this->conn,$query);        $query ="UPDATE ct_order_client_info SET client_name = '".$username."', client_email = '".$email."', client_phone = '".$phone."' where order_id = $orderid";        $result=mysqli_query($this->conn,$query);        $query ="UPDATE ct_bookings SET method_unit_id = '".$room."', method_id = '".$room."', service_id = '".$room."', method_unit_qty = '".$players."',method_unit_qty_rate = '".$amountdue."',booking_date_time = '".$finaldate."',booking_status = '".$bookingstatus."',read_status = '".$readstatus."',lastmodify = '".$lastmodify."' where order_id = $orderid";        $result=mysqli_query($this->conn,$query);        $query ="insert into admin_logs values ('', '".$_SESSION['adminid']."', 'Rescheduled or Updated Booking : ".$orderid."', now())";        $result=mysqli_query($this->conn,$query);        return $result;    }        public function process_payment_admin($order_id,$amount_paid, $payment_type){                //$query ="UPDATE ct_payments SET transaction_id = '".$payment_type."', partial_amount = '".$amount_paid."' where order_id = '".$order_id."'";        //$result=mysqli_query($this->conn,$query);                $query ="insert into ct_payment_breakdown values ('', '".$order_id."', now(), '".$payment_type."', '".$amount_paid."')";        $result=mysqli_query($this->conn,$query);                $query ="insert into admin_logs values ('', '".$_SESSION['adminid']."', 'Order ".$order_id." Payment : ".$payment_type." (R".$amount_paid.")', now())";        $result=mysqli_query($this->conn,$query);        return $result;    }        public function process_players_admin($order,$player1,$player2,$player3,$player4,$player5,$player6,$player7,$player8){        $query ="insert into ct_order_client_players values ('".$order."', '".$player1."', '".$player2."', '".$player3."', '".$player4."', '".$player5."', '".$player6."', '".$player7."', '".$player8."') on duplicate key update player1 = '".$player1."', player2 = '".$player2."', player3 = '".$player3."', player4 = '".$player4."', player5 = '".$player5."', player6 = '".$player6."', player7 = '".$player7."', player8 = '".$player8."'";        $result=mysqli_query($this->conn,$query);        $query ="insert into admin_logs values ('', '".$_SESSION['adminid']."', 'Updated players:(Booking : ".$order.", ".$player1.", ".$player2.", ".$player3.", ".$player4.", ".$player5.", ".$player6.", ".$player7.", ".$player8.")', now())";        $result=mysqli_query($this->conn,$query);        return $result;    }           public function process_progress_admin($order,$hint,$remove){        if ($remove == 1) {        	$query ="delete from ct_bookings_progress where booking_id = '".$order."' and progress_no = '".$hint."'";        } else {        	$query ="insert into ct_bookings_progress (booking_id, progress_time, progress_no) values ('".$order."', now(), '".$hint."')";        }        $result=mysqli_query($this->conn,$query);        return $result;    }        public function new_booking_admin($payment, $finaldate,$bookingstatus,$readstatus,$lastmodify,$amountdue, $players, $room, $username, $email, $phone){    		$query="select max(order_id) from ct_bookings";        $result=mysqli_query($this->conn,$query);        $value=mysqli_fetch_row($result);        $new_booking_id = $value[0]+1;                $query ="insert into ct_bookings (order_id, order_date, booking_date_time, service_id, method_id, method_unit_id, method_unit_qty, method_unit_qty_rate, booking_status, lastmodify, read_status) values         																 (".$new_booking_id.", now(), '".$finaldate."', '".$room."', '".$room."', '".$room."','".$players."', '".$amountdue."', '".$bookingstatus."', now(), '".$readstatus."')";        $result=mysqli_query($this->conn,$query);                $query ="insert into ct_order_client_info (order_id, client_name, client_email, client_phone) values         																 (".$new_booking_id.", '".$username."', '".$email."', '".$phone."')";        $result=mysqli_query($this->conn,$query);                $query ="insert into ct_payments (order_id, payment_method, amount, net_amount, lastmodify) values         																 (".$new_booking_id.", '".$payment."', '".$amountdue."', '".$amountdue."', now())";        $result=mysqli_query($this->conn,$query);                $query ="insert into admin_logs values ('', '".$_SESSION['adminid']."', 'Created New Booking :".$new_booking_id."', now())";        $result=mysqli_query($this->conn,$query);                return $result;    }        public function current_booking() {    	$query="select max(order_id) from ct_bookings";      $result=mysqli_query($this->conn,$query);      $value=mysqli_fetch_row($result);      return $value[0];    }            /* UPDATE CLIENT PERSONAL INFO IN ORDER CLIENT INFO AFTER RESCHEDULE */    public function update_notes($orderid,$client_personal_info){        $query ="UPDATE ct_order_client_info SET client_personal_info = '".$client_personal_info."' where order_id = $orderid";        $result=mysqli_query($this->conn,$query);        return $result;    }    /* UPDATE STATUS OF BOOKING IF USER CANCEL BY ITES OWN */    public function update_booking_of_user($orderid){        $query ="UPDATE ct_bookings SET booking_status = 'CC' where order_id = $orderid";        $result=mysqli_query($this->conn,$query);        return $result;    }}