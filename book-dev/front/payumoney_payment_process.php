<?php 		session_start();	ob_start();	include(dirname(dirname(__FILE__)).'/header.php');	include(dirname(dirname(__FILE__)).'/objects/class_connection.php');		require(dirname(dirname(__FILE__)).'/objects/class_pyapal_express_checkout.php');	include(dirname(dirname(__FILE__)).'/objects/class_setting.php');	include(dirname(dirname(__FILE__)).'/objects/class_services.php');	$database= new cleanto_db();	$conn=$database->connect();	$database->conn=$conn;	$settings=new cleanto_setting();	$settings->conn=$conn;	$service = new cleanto_services();	$service->conn=$conn;	$booking_Info = $_SESSION['ct_details'];					$partialdeposite_status = $settings->get_option('ct_partial_deposit_status');	if($partialdeposite_status=='Y'){		$amt = @number_format($booking_Info['partial_amount'],2,".",',');	}else{		$amt = @number_format($booking_Info['net_amount'],2,".",',');	}	if($booking_Info['existing_username']!=''){ 		$emails=$booking_Info['existing_username']; 	}else{ 		$emails=$booking_Info['email']; 	}	$arr = array();	$MERCHANT_KEY = $settings->get_option('ct_payumoney_merchant_key');	$arr['merchant_key'] = $MERCHANT_KEY;	$SALT = $settings->get_option('ct_payumoney_salt');	$arr['salt'] = $SALT;	$amt_clean = str_replace(',','',$amt);	$amt_clean = str_replace('.','',$amt_clean);	if ($amt_clean <= 1000) { $arr['amt'] = $amt_clean*100; } else { $arr['amt'] = $amt_clean; }	$arr['fname'] = $booking_Info['firstname'];	$arr['email'] = $emails;	$arr['phone'] = $booking_Info['phone'];		$txnid = substr(hash('sha256', mt_rand() . microtime()), 0, 20);	$arr['txnid'] = $txnid;	$productinfo = 'product description';		$arr['productinfo'] = $productinfo;	$arr['payu_surl'] = SITE_URL."front/payumoney_success.php";	$arr['payu_furl'] = gmstrftime("%Y-%m-%d %H:%M");	$arr['service_provider'] = "payu_paisa";	$hash_string = $MERCHANT_KEY.$txnid.$arr['amt'].'ZAR'.$arr['payu_surl'].$arr['payu_furl'].'enZAF'.$emails.$SALT;	$arr['hash'] = md5($hash_string);		$ch = curl_init();	curl_setopt($ch, CURLOPT_URL,"https://secure.paygate.co.za/payweb3/initiate.trans");	curl_setopt($ch, CURLOPT_POST, 1);	curl_setopt($ch, CURLOPT_POSTFIELDS, "PAYGATE_ID=".$MERCHANT_KEY."&REFERENCE=".$txnid."&AMOUNT=".$arr['amt']."&CURRENCY=ZAR&RETURN_URL=".$arr['payu_surl']."&TRANSACTION_DATE=".$arr['payu_furl']."&LOCALE=en&COUNTRY=ZAF&EMAIL=".$emails."&CHECKSUM=".$arr['hash']);	curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);	$server_output = curl_exec ($ch);	curl_close ($ch);	parse_str($server_output, $server_output);	$server_output['PAYGATE_ID'];	$server_output['PAY_REQUEST_ID'];	$server_output['REFERENCE'];	$arr['hash'] = $server_output['CHECKSUM'];	$arr['email'] = $server_output['PAY_REQUEST_ID'];		echo json_encode($arr);die;?>